<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Metal Reactions Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease;
            position: relative; /* Needed for confetti canvas */
        }
        .btn {
            border-radius: 0.5rem;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        .option-btn {
            border: 1px solid #d1d5db;
            transition: all 0.2s ease-in-out;
            height: 100%; /* Make buttons in a row same height */
        }
        .option-btn:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
        }
        .option-btn.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }
        .option-btn.incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        .hidden { display: none; }
        .feedback {
            border-left-width: 4px;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .feedback-correct {
            border-color: #22c55e;
            background-color: #f0fdf4;
        }
        .feedback-incorrect {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex; justify-content: center; align-items: center;
            z-index: 50; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content {
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content { transform: scale(1); }
        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicking through the canvas */
            z-index: 100;
        }
    </style>
</head>
<body class=" text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-extrabold text-gray-800 tracking-tight">Metal Reactions Quiz</h1>
            <p class="text-xl text-gray-600 mt-2">Test your knowledge of the Reactivity Series</p>
        </header>

        <div class="card">
            <!-- Setup Screen -->
            <div id="setup-screen" class="text-center">
                <h2 class="text-2xl font-bold mb-4">Quiz Setup</h2>
                <div class="inline-block text-left">
                    <label for="num-questions" class="block mb-2 font-medium">Number of Questions:</label>
                    <select id="num-questions" class="p-2 border rounded-lg mb-6 w-full">
                        <option value="5" selected>5 Questions</option>
                        <option value="10">10 Questions</option>
                    </select>
                </div>
                <button id="start-quiz-btn" class="w-full btn btn-primary">Start Quiz</button>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="hidden">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-2xl font-bold">Question <span id="question-number"></span>/<span id="total-questions"></span></h2>
                     <div class="text-lg font-bold bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">Score: <span id="score">0</span></div>
                </div>
                <p id="question-text" class="text-xl mb-6 bg-gray-100 p-4 rounded-lg"></p>
                <div id="options-container" class="options-grid"></div>
                <div id="feedback-container" class="hidden"></div>
                <button id="next-question-btn" class="hidden w-full mt-4 btn bg-gray-700 text-white hover:bg-gray-800">Next Question</button>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden text-center">
                <canvas id="confetti-canvas"></canvas>
                <h2 id="results-title" class="text-3xl font-bold mb-4">Quiz Complete!</h2>
                <p class="text-xl mb-2">Your final score is:</p>
                <p class="text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-purple-500 mb-6" id="final-score"></p>
                <button id="restart-quiz-btn" class="w-full btn btn-primary">Try Again</button>
            </div>

            <div class="text-center mt-6">
                <button id="show-reactivity-btn" class="text-indigo-600 hover:text-indigo-800 font-semibold">
                    <i class="fas fa-list-ol mr-2"></i>Show Reactivity Series
                </button>
            </div>
        </div>
    </div>

    <!-- Reactivity Series Modal -->
    <div id="reactivity-modal" class="modal">
        <div class="modal-content card w-11/12 max-w-md">
            <h2 class="text-2xl font-bold mb-4 text-center">Reactivity Series</h2>
            <div id="reactivity-series-list" class="space-y-2 text-center"></div>
            <div class="text-center mt-4">
                <span class="font-bold text-green-600">Most Reactive</span> &uarr; <br>
                <span class="font-bold text-red-600">Least Reactive</span> &darr;
            </div>
            <button id="close-modal-btn" class="w-full mt-6 btn bg-gray-200 text-gray-800 hover:bg-gray-300">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const metalData = {
                'K': { name: 'Potassium', reactivity: 12, reactions: {
                    air: { products: 'Potassium Oxide', explanation: 'Potassium is a very reactive alkali metal and oxidizes rapidly in air.' },
                    cold_water: { products: 'Potassium Hydroxide + Hydrogen', explanation: 'Reacts explosively with cold water due to its high reactivity.' },
                    steam: { products: 'Potassium Hydroxide + Hydrogen', explanation: 'Reacts even more violently with steam than with cold water.' },
                    acid: { products: 'Potassium Chloride + Hydrogen', explanation: 'A vigorous, explosive reaction occurs with dilute acids.' },
                    sulphuric_acid: { products: 'Potassium Sulphate + Hydrogen', explanation: 'A vigorous, explosive reaction occurs with dilute acids.'}
                }},
                'Na': { name: 'Sodium', reactivity: 11, reactions: {
                    air: { products: 'Sodium Oxide', explanation: 'Sodium tarnishes quickly in air, forming a layer of sodium oxide.' },
                    cold_water: { products: 'Sodium Hydroxide + Hydrogen', explanation: 'Reacts vigorously with cold water, fizzing and moving across the surface.' },
                    steam: { products: 'Sodium Hydroxide + Hydrogen', explanation: 'Reacts very vigorously with steam.' },
                    acid: { products: 'Sodium Chloride + Hydrogen', explanation: 'Reacts rapidly with dilute acids to produce hydrogen gas.' },
                    sulphuric_acid: { products: 'Sodium Sulphate + Hydrogen', explanation: 'Reacts rapidly with dilute acids to produce hydrogen gas.'}
                }},
                'Ca': { name: 'Calcium', reactivity: 10, reactions: {
                    air: { products: 'Calcium Oxide', explanation: 'Reacts with oxygen in the air, especially when heated, to form calcium oxide.' },
                    cold_water: { products: 'Calcium Hydroxide + Hydrogen', explanation: 'Reacts steadily with cold water, producing bubbles of hydrogen.' },
                    steam: { products: 'Calcium Hydroxide + Hydrogen', explanation: 'Reacts more vigorously with steam than with cold water.' },
                    acid: { products: 'Calcium Chloride + Hydrogen', explanation: 'Reacts readily with dilute acids.' },
                    sulphuric_acid: { products: 'Calcium Sulphate + Hydrogen', explanation: 'Reacts readily, but can be slowed by the formation of insoluble calcium sulphate.'}
                }},
                'Mg': { name: 'Magnesium', reactivity: 9, reactions: {
                    air: { products: 'Magnesium Oxide', explanation: 'Burns with a brilliant white light in air to form magnesium oxide.' },
                    cold_water: { products: 'No Reaction', explanation: 'Magnesium reacts extremely slowly with cold water, so it is considered non-reactive.' },
                    steam: { products: 'Magnesium Oxide + Hydrogen', explanation: 'Reacts with steam to produce magnesium oxide and hydrogen gas.' },
                    acid: { products: 'Magnesium Chloride + Hydrogen', explanation: 'Reacts very quickly with dilute acids.' },
                    sulphuric_acid: { products: 'Magnesium Sulphate + Hydrogen', explanation: 'Reacts very quickly with dilute acids.'}
                }},
                'Al': { name: 'Aluminium', reactivity: 8, reactions: {
                    air: { products: 'Aluminium Oxide', explanation: 'A protective, unreactive layer of aluminium oxide quickly forms on its surface, preventing further reaction.' },
                    cold_water: { products: 'No Reaction', explanation: 'The protective oxide layer prevents any reaction with cold water.' },
                    steam: { products: 'Aluminium Oxide + Hydrogen', explanation: 'Reacts with steam only if the protective oxide layer is removed.' },
                    acid: { products: 'Aluminium Chloride + Hydrogen', explanation: 'Reacts with dilute acids, but the reaction may be slow to start due to the oxide layer.' },
                    sulphuric_acid: { products: 'Aluminium Sulphate + Hydrogen', explanation: 'Reacts with dilute acids, but the reaction may be slow to start due to the oxide layer.'}
                }},
                'Zn': { name: 'Zinc', reactivity: 7, reactions: {
                    air: { products: 'Zinc Oxide', explanation: 'Forms a protective layer of zinc oxide in the air, preventing further corrosion.' },
                    cold_water: { products: 'No Reaction', explanation: 'Zinc does not react with cold water.' },
                    steam: { products: 'Zinc Oxide + Hydrogen', explanation: 'Reacts with steam when heated to form zinc oxide and hydrogen.' },
                    acid: { products: 'Zinc Chloride + Hydrogen', explanation: 'Reacts with dilute acids to produce hydrogen gas.' },
                    sulphuric_acid: { products: 'Zinc Sulphate + Hydrogen', explanation: 'Reacts with dilute acids to produce hydrogen gas.'}
                }},
                'Fe': { name: 'Iron', reactivity: 6, reactions: {
                    air: { products: 'Iron(III) Oxide', explanation: 'Slowly rusts in moist air to form hydrated iron(III) oxide.' },
                    cold_water: { products: 'No Reaction', explanation: 'Iron does not react with cold water.' },
                    steam: { products: 'Iron(II,III) Oxide + Hydrogen', explanation: 'Reacts with steam at high temperatures to form a mixed oxide of iron.' },
                    acid: { products: 'Iron(II) Chloride + Hydrogen', explanation: 'Reacts slowly with dilute acids to form an iron(II) salt and hydrogen.' },
                    sulphuric_acid: { products: 'Iron(II) Sulphate + Hydrogen', explanation: 'Reacts slowly with dilute acids to form an iron(II) salt and hydrogen.'}
                }},
                'Pb': { name: 'Lead', reactivity: 5, reactions: {
                    air: { products: 'Lead(II) Oxide', explanation: 'A dull layer of lead(II) oxide forms on its surface in air.' },
                    cold_water: { products: 'No Reaction', explanation: 'Lead is too unreactive to react with cold water.' },
                    steam: { products: 'No Reaction', explanation: 'Lead is too unreactive to react with steam.' },
                    acid: { products: 'Lead(II) Chloride + Hydrogen', explanation: 'Reacts very slowly as a layer of insoluble lead(II) chloride forms, stopping the reaction.' },
                    sulphuric_acid: { products: 'Lead(II) Sulphate + Hydrogen', explanation: 'Reacts very slowly as a layer of insoluble lead(II) sulphate forms, stopping the reaction.'}
                }},
                'Cu': { name: 'Copper', reactivity: 4, reactions: {
                    air: { products: 'Copper(II) Oxide', explanation: 'Slowly reacts with oxygen over time, or when heated, to form a black layer of copper(II) oxide.' },
                    cold_water: { products: 'No Reaction', explanation: 'Copper is below hydrogen in the reactivity series and does not react with cold water.' },
                    steam: { products: 'No Reaction', explanation: 'Copper does not react with steam.' },
                    acid: { products: 'No Reaction', explanation: 'As copper is less reactive than hydrogen, it does not react with dilute non-oxidizing acids.' },
                    sulphuric_acid: { products: 'No Reaction', explanation: 'As copper is less reactive than hydrogen, it does not react with dilute non-oxidizing acids.'}
                }},
                'Ag': { name: 'Silver', reactivity: 2, reactions: {
                    air: { products: 'No Reaction', explanation: 'Silver is very unreactive and does not react with oxygen in the air.' },
                    cold_water: { products: 'No Reaction', explanation: 'Silver is a very unreactive metal.' },
                    steam: { products: 'No Reaction', explanation: 'Silver is a very unreactive metal.' },
                    acid: { products: 'No Reaction', explanation: 'Silver is less reactive than hydrogen and will not react with dilute acids.' },
                    sulphuric_acid: { products: 'No Reaction', explanation: 'Silver is less reactive than hydrogen and will not react with dilute acids.'}
                }},
                'Au': { name: 'Gold', reactivity: 1, reactions: {
                    air: { products: 'No Reaction', explanation: 'Gold is extremely unreactive and does not tarnish or react with air.' },
                    cold_water: { products: 'No Reaction', explanation: 'Gold is extremely unreactive.' },
                    steam: { products: 'No Reaction', explanation: 'Gold is extremely unreactive.' },
                    acid: { products: 'No Reaction', explanation: 'Gold is one of the least reactive metals and does not react with single acids.' },
                    sulphuric_acid: { products: 'No Reaction', explanation: 'Gold is one of the least reactive metals and does not react with single acids.'}
                }}
            };
            
            // --- Sound Synthesis ---
            const correctSound = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 } }).toDestination();
            const incorrectSound = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.4, sustain: 0, release: 0.2 } }).toDestination();

            // --- UI Elements ---
            const setupScreen = document.getElementById('setup-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultsScreen = document.getElementById('results-screen');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const restartQuizBtn = document.getElementById('restart-quiz-btn');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            const questionNumberEl = document.getElementById('question-number');
            const totalQuestionsEl = document.getElementById('total-questions');
            const scoreEl = document.getElementById('score');
            const questionTextEl = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const finalScoreEl = document.getElementById('final-score');
            const resultsTitleEl = document.getElementById('results-title');
            const numQuestionsSelect = document.getElementById('num-questions');
            const feedbackContainer = document.getElementById('feedback-container');
            const reactivityModal = document.getElementById('reactivity-modal');
            const showReactivityBtn = document.getElementById('show-reactivity-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            
            let questions = [];
            let currentQuestionIndex = 0;
            let score = 0;
            const correctMessages = ["Great job!", "Excellent!", "You've got it!", "Correct!", "Awesome!"];
            const incorrectMessages = ["Not quite.", "Keep trying!", "That's a common mistake.", "Almost there."];

            // --- Populate Reactivity Series ---
            const reactivitySeriesList = document.getElementById('reactivity-series-list');
            const sortedMetals = Object.keys(metalData).sort((a, b) => metalData[b].reactivity - metalData[a].reactivity);
            sortedMetals.forEach(symbol => {
                const item = document.createElement('div');
                item.textContent = `${metalData[symbol].name} (${symbol})`;
                item.className = 'p-2 border rounded-lg bg-gray-100';
                reactivitySeriesList.appendChild(item);
            });

            function startQuiz() {
                Tone.start();
                const numQuestions = parseInt(numQuestionsSelect.value);
                score = 0;
                currentQuestionIndex = 0;
                questions = generateQuestions(numQuestions);

                setupScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                nextQuestionBtn.classList.add('hidden');
                feedbackContainer.classList.add('hidden');
                
                totalQuestionsEl.textContent = numQuestions;
                scoreEl.textContent = score;

                displayQuestion();
            }

            function generateQuestions(num) {
                const allQuestions = [];
                const reactants = {
                    air: 'air',
                    cold_water: 'cold water',
                    steam: 'steam',
                    acid: 'dilute HCl',
                    sulphuric_acid: 'dilute H₂SO₄'
                };
                
                for (const metalSymbol in metalData) {
                    for (const reactantKey in reactants) {
                        allQuestions.push({
                            metal: metalData[metalSymbol].name,
                            reactant: reactants[reactantKey],
                            answer: metalData[metalSymbol].reactions[reactantKey].products,
                            explanation: metalData[metalSymbol].reactions[reactantKey].explanation
                        });
                    }
                }
                
                return allQuestions.sort(() => 0.5 - Math.random()).slice(0, num);
            }

            function displayQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    showResults();
                    return;
                }
                feedbackContainer.classList.add('hidden');
                const question = questions[currentQuestionIndex];
                questionNumberEl.textContent = currentQuestionIndex + 1;
                questionTextEl.textContent = `What are the product(s) when ${question.metal.toLowerCase()} reacts with ${question.reactant}?`;
                
                optionsContainer.innerHTML = '';
                nextQuestionBtn.classList.add('hidden');
                
                const options = generateOptions(question.answer, question.metal);
                options.forEach(optionText => {
                    const button = document.createElement('button');
                    button.textContent = optionText;
                    button.className = 'option-btn btn';
                    button.onclick = () => checkAnswer(optionText, question.answer, button, question.explanation);
                    optionsContainer.appendChild(button);
                });
            }

            function generateAllPossibleProducts(metalName) {
                const hasRomanNumeral = ['Iron', 'Lead', 'Copper'].includes(metalName);

                if (hasRomanNumeral) {
                    const oxide = metalName === 'Iron' ? 'Iron(III) Oxide' : `${metalName}(II) Oxide`;
                    const hydroxide = `${metalName}(II) Hydroxide + Hydrogen`;
                    const oxideHydrogen = `${metalName}(II) Oxide + Hydrogen`;
                    const chloride = `${metalName}(II) Chloride + Hydrogen`;
                    const sulphate = `${metalName}(II) Sulphate + Hydrogen`;
                    return [ oxide, hydroxide, oxideHydrogen, chloride, sulphate, 'No Reaction' ];
                } else {
                    return [
                        `${metalName} Oxide`, `${metalName} Hydroxide + Hydrogen`, `${metalName} Oxide + Hydrogen`,
                        `${metalName} Chloride + Hydrogen`, `${metalName} Sulphate + Hydrogen`, 'No Reaction'
                    ];
                }
            }

            function generateOptions(correctAnswer, metalName) {
                let options = new Set([correctAnswer]);
                const distractors = generateAllPossibleProducts(metalName);
                while (options.size < 4) {
                    const randomDistractor = distractors[Math.floor(Math.random() * distractors.length)];
                    options.add(randomDistractor);
                }
                return Array.from(options).sort(() => 0.5 - Math.random());
            }

            function checkAnswer(selectedAnswer, correctAnswer, button, explanation) {
                const buttons = optionsContainer.querySelectorAll('.option-btn');
                buttons.forEach(btn => btn.disabled = true);
                
                feedbackContainer.innerHTML = '';
                const encouragement = document.createElement('p');
                encouragement.className = 'font-bold mb-2';
                const explanationText = document.createElement('p');
                
                if (selectedAnswer === correctAnswer) {
                    score++;
                    scoreEl.textContent = score;
                    button.classList.add('correct');
                    correctSound.triggerAttackRelease('C5', '8n', Tone.now());
                    encouragement.textContent = correctMessages[Math.floor(Math.random() * correctMessages.length)];
                    feedbackContainer.className = 'feedback feedback-correct';
                } else {
                    button.classList.add('incorrect');
                    incorrectSound.triggerAttackRelease('A2', '8n', Tone.now());
                    buttons.forEach(btn => {
                        if (btn.textContent === correctAnswer) {
                            btn.classList.add('correct');
                        }
                    });
                    encouragement.textContent = incorrectMessages[Math.floor(Math.random() * incorrectMessages.length)];
                    feedbackContainer.className = 'feedback feedback-incorrect';
                }
                
                explanationText.textContent = explanation;
                feedbackContainer.appendChild(encouragement);
                feedbackContainer.appendChild(explanationText);
                feedbackContainer.classList.remove('hidden');
                nextQuestionBtn.classList.remove('hidden');
            }

            function showResults() {
                quizScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                const finalScore = score / questions.length;
                finalScoreEl.textContent = `${score} / ${questions.length}`;

                if (finalScore >= 0.8) {
                    resultsTitleEl.textContent = "Excellent Work!";
                    const confettiCanvas = document.getElementById('confetti-canvas');
                    const myConfetti = confetti.create(confettiCanvas, {
                        resize: true,
                        useWorker: true
                    });
                    myConfetti({
                        particleCount: 200,
                        spread: 160,
                        origin: { y: 0.6 }
                    });
                } else if (finalScore >= 0.5) {
                    resultsTitleEl.textContent = "Good Job!";
                } else {
                    resultsTitleEl.textContent = "Keep Practicing!";
                }
            }

            // --- Event Listeners ---
            startQuizBtn.addEventListener('click', startQuiz);
            restartQuizBtn.addEventListener('click', () => {
                resultsScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
            });
            nextQuestionBtn.addEventListener('click', () => {
                currentQuestionIndex++;
                displayQuestion();
            });
            showReactivityBtn.addEventListener('click', () => reactivityModal.classList.add('active'));
            closeModalBtn.addEventListener('click', () => reactivityModal.classList.remove('active'));
            reactivityModal.addEventListener('click', (e) => {
                if (e.target === reactivityModal) {
                    reactivityModal.classList.remove('active');
                }
            });
        });
    </script>

</body>
</html>
